---
interface Props {
  title: string;
  activeNav?: string;
}

const { title, activeNav = '' } = Astro.props;

const navItems = [
  { href: '/', label: 'Dashboard', id: 'calendar' },
  { href: '/spark', label: 'Daily Spark', id: 'spark' },
  { href: '/workout', label: 'Workout', id: 'workout' },
  { href: '/meal-prep', label: 'Meal Prep', id: 'meal-prep' },
  { href: '/nutrition', label: 'Nutrition', id: 'nutrition' },
  { href: '/metrics', label: 'Metrics', id: 'metrics' },
];
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ClarkStark - High-Tech Fitness Tracker" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <title>{title} | ClarkStark</title>
    <script is:inline>
      // Check for saved theme preference or default to dark
      const theme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>
  <body class="min-h-screen">
    <div class="max-w-6xl mx-auto px-4 py-6">
      <!-- Header -->
      <header class="flex items-center justify-between mb-8 relative">
        <div class="flex items-center gap-4">
          <a href="/" class="flex items-center gap-3 group">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg glow-orange">
              <span class="text-xl">ðŸ’ª</span>
            </div>
            <span class="text-xl font-bold gradient-text">ClarkStark</span>
          </a>
          <!-- Streak Counter -->
          <div id="header-streak" class="flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-bold card-glow">
            <span class="text-base">ðŸ”¥</span>
            <span id="streak-count" class="gradient-text">-</span>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <!-- Desktop Navigation -->
          <nav class="hidden md:flex items-center gap-1">
            {navItems.map(item => (
              <a
                href={item.href}
                class={`nav-link ${activeNav === item.id ? 'active' : ''}`}
              >
                {item.label}
              </a>
            ))}
          </nav>

          <!-- Theme Toggle -->
          <button
            id="theme-toggle"
            class="theme-toggle"
            aria-label="Toggle dark mode"
            title="Toggle theme"
          >
            <span class="sr-only">Toggle theme</span>
          </button>

          <!-- Mobile Hamburger Button -->
          <button
            id="mobile-menu-btn"
            class="md:hidden p-2 rounded-lg hover:bg-[var(--bg-glass)] transition-colors"
            aria-label="Toggle menu"
            aria-expanded="false"
          >
            <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Mobile Navigation Menu -->
        <nav
          id="mobile-menu"
          class="hidden absolute top-full right-0 mt-2 w-56 card py-2 z-50"
        >
          {navItems.map(item => (
            <a
              href={item.href}
              class={`block px-4 py-3 transition-colors ${activeNav === item.id ? 'gradient-text font-semibold' : 'text-[var(--text-secondary)] hover:text-[var(--text-primary)]'}`}
            >
              {item.label}
            </a>
          ))}
        </nav>
      </header>

      <!-- Main content -->
      <main>
        <slot />
      </main>

      <!-- Footer -->
      <footer class="mt-12 py-6 text-center text-sm" style="color: var(--text-muted)">
        <div class="flex items-center justify-center gap-2">
          <span class="gradient-text font-semibold">ClarkStark</span>
          <span>&copy; 2026</span>
          <span class="text-[var(--text-muted)]">â€¢</span>
          <span>Best Shape at 50</span>
        </div>
      </footer>
    </div>

    <!-- Streak Loader Script -->
    <script>
      async function loadStreak() {
        try {
          const res = await fetch('/api/streak');
          const data = await res.json();
          const streakEl = document.getElementById('streak-count');
          if (streakEl) {
            streakEl.textContent = `Day ${data.current_streak || 0}`;
          }
        } catch (err) {
          console.error('Failed to load streak:', err);
        }
      }
      loadStreak();
    </script>

    <!-- Theme Toggle Script -->
    <script>
      const themeToggle = document.getElementById('theme-toggle');

      themeToggle?.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });
    </script>

    <!-- Mobile Menu Script -->
    <script>
      const menuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');

      function openMenu() {
        mobileMenu?.classList.remove('hidden');
        menuIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        menuBtn?.setAttribute('aria-expanded', 'true');
      }

      function closeMenu() {
        mobileMenu?.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        menuBtn?.setAttribute('aria-expanded', 'false');
      }

      function toggleMenu() {
        const isHidden = mobileMenu?.classList.contains('hidden');
        if (isHidden) {
          openMenu();
        } else {
          closeMenu();
        }
      }

      menuBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu();
      });

      document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (!mobileMenu?.contains(target) && !menuBtn?.contains(target)) {
          closeMenu();
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeMenu();
        }
      });
    </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
